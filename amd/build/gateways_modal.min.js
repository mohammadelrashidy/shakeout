define(["jquery","core/modal_factory","core/modal_events","core/str","core/ajax"],function(e,t,a,r,n){"use strict";var o=function(e,n,o,i){return new Promise(function(c,s){var u=t.create({type:t.types.DEFAULT,title:r.get_string("paymentconfirm","paygw_shakeout"),body:r.get_string("paymentconfirmdesc","paygw_shakeout")});u.then(function(t){return t.setFooter('<button type="button" class="btn btn-primary" data-action="pay">Pay Now</button><button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>'),t.getRoot().on("click",'[data-action="pay"]',function(){t.hide();var a=M.cfg.wwwroot+"/payment/gateway/shakeout/pay.php",r=new URLSearchParams({component:e,paymentarea:n,itemid:o,description:i,sesskey:M.cfg.sesskey}),d=window.open(a+"?"+r.toString(),"shakeout_payment","width=800,height=600,scrollbars=yes,resizable=yes");d&&d.focus(),c()}),t.getRoot().on("click",'[data-action="cancel"]',function(){t.hide(),s(new Error("Payment cancelled by user"))}),t.show(),t}).catch(function(e){console.error("Shake-Out: Error creating payment modal:",e),s(e)})})};return{process:o}});